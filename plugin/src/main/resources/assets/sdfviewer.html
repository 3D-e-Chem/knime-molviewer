<!DOCTYPE html>
<html>
<head>
    <title>Molecule tiles</title>
    <script src="js/jquery-3.1.0.min.js"></script>
    <script lang="javascript">
    // disable phone home
    $.get = function(){};
    </script>
    <script src="js/3Dmol/3Dmol-nojquery.js"></script>
    <style>
    </style>
    <script lang="javascript">
    $(document).ready(function() {
        var element = $('#gldiv');
        var config = {
            defaultcolors : $3Dmol.rasmolElementColors
        };
        var glviewer = $3Dmol.createViewer(element, config);
        glviewer.setBackgroundColor(0xffffff);
        var ligands = [];
        fetch('/api/ligands').then(function(response) {
            return response.json()
        }).then(function(data) {
            ligands = data.map(function(d) {
                return glviewer.addModel(d, 'sdf');
            });
            glviewer.setStyle({model: ligands}, {stick: {}});
            glviewer.zoomTo();
            glviewer.render();
        });
        // listen for model changes from server
        var evtSource = new EventSource("/api/broadcast");
        evtSource.onmessage = function(e) {
            console.log(e);
        };
        evtSource.onerror = function(e) {
            console.error(e);
            this.close();
        };
    });
    </script>
</head>
<body>
<div id="gldiv" style="width: 800px; height: 800px; margin: 0; padding: 0; border: 0;"></div>
</body>
